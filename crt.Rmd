---
output:
  html_document:
    toc: true
    toc_float: true
    toc_depth: 2
---

```{r, echo=FALSE, warning=FALSE, message=FALSE}
library(dplyr); library(RColorBrewer)
library(ggplot2);library(gridExtra)
library(knitr); library(kableExtra)
library(scales); library(foreach)
library(plotly); library(grid)

'%ni%' <- Negate('%in%')

opts_chunk$set(warning=FALSE, message=FALSE, echo=FALSE, row.names = FALSE, cache=TRUE,
               fig.align = 'center',  fig.width=6, fig.height=4, results = 'hide')
options(knitr.kable.NA = '', knitr.table.format = "html") 

source("C:/Dropbox/Professional/Grants_Current/SS Chemistry Data Mining/code/helper functions.R")
raw <-read.delim("C:/Dropbox/Professional/Grants_Current/SS Chemistry Data Mining/data/chem_data_20170227.txt", sep = "\t")

ew <- raw %>% filter(((term_idx == "F14" & section==1) | crt==1)  &
                        !is.na(gender) & !is.na(stulevel) & grade %ni% c('W ', 'I ')) %>% 
      droplevels() %>%
      mutate(repeat_grade = ifelse(grade %in% c('D ', 'D+', 'F ', 'WU'), 1, 0),
             pass = factor(repeat_grade, labels=c("Pass", "Fail")),
             term_idx = factor(term_idx, levels=c("F14","F15", "S16", "F16")),
             DSS = ifelse(dss.1==1 | dss == 'Y', 'DSS', 'not in DSS'), 
             soc = factor(soc, levels=c('Non-SOC', 'SOC', 'Multiple/Mixed')), 
             eop = factor(eop, labels=c("Non-EOP", "EOP"))) %>%
      select(-dss.1, -dss, -erss_stulevel, erss_enrstat)

ew$crt[ew$term_idx == "F16"] <- 2
ew$crt <- factor(ew$crt, labels=c("Traditional", "CRT", "CRT+SI"))
ew$urm_status <- factor(ew$urm_status, levels=c("Non-URM", "URM", "Unknown"))

class <- ew %>% group_by(year, term, term_idx, section, crt) %>%
          summarise(classgpa = mean(gpa), dfw = sum(repeat_grade), 
                    N = n(), dfw_rate = dfw/N)

f146 <- filter(ew, term_idx %in% c("F14", "F16")) %>% droplevels()

# viz opts
yearlab <- c(2009, rep(2010:2016, each=2))
term.col <- brewer.pal(9, "Set1")[c(7, 3)]
crt.col <- brewer.pal(9, "Set1")[1:3]
sex.col <- brewer.pal(10, "Paired")[c(8,10)]
```

# Analysis Overview

To analyze the effect of the course redesign, we consider data from Fall 2014 to Fall 2016, for all sections of Chemistry 111. Students withdrawing or receiving an incomplete (`W/I`) are excluded from this analysis. A repeatable grade is defined as a student receiving a *D*, *D+*, *F* grade, or an unexcused withdrawal *WU*. 

1. Examine bivariate associations between outcome measures, covariates and the CRT intervention condition. 
    a. Student and class level characteristics are used as covariates. 
    b. Each predictor is compared to the intervention condition (CRT vs Traditional), and to the outcomes (GPA and receipt of a repeatable grade.)
    c. Analysis is done on two sets of data samples: 
        - All terms (Full sample) 
        - Just F14 and F16 terms only 
2. Model building - Start with variables that were shown to be bivariately associated with either intervention or outcome, build a multivariable statistical model to assess the effect of the CRT on student performance. 
3. Use a supervised machine learning technique to identify other key characteristics highly predictive of a student receiving a repeatable grade. 


### Outcome measurements

**1. GPA**

Since GPA is being treated as a continuous variable, distributions of GPA are displayed using boxplots with overlaid violin plots. The diamonds represent the average or mean value for that group. Two-sample T-tests and ANOVA tests are used to compare the average GPA across levels of the covariate of interest. 

**2. Receipt of a repeatable grade**

We also dichotomize the grade a student received and create an indicator for whether or not the student received a repeatable grade. This is also called the _failure rate_ in some places in this report. 

Where the sample size is large enough, $\chi^{2}$ tests for equal proportions across two / and multiple groups are conducted, otherwise Fishers Exact Tests are used. Any comparison where a zero cell occurs (a combination of factors that does not exist in the data), no statistical test is conducted. 

# Performance Outcomes

We examine four semesters of data from a single instructor. One semester of traditional course offering from F14, two semesters of redesigned courses (F15, S16) and one semester of the redesign with an SI enhancement. These are colored in red, blue and green respectively in most plots. 

### GPA
The overall distribution of gpa for the crt courses has shifted in the positive direction compared to the traditional courses. The mean for Fall 15 and F16 are higher than F14, with S16 closer to F14 than the other redesigned terms. The variance in GPA from the last semester is much higher than the rest, potentially indicating that the effect of SI did not have a uniform impact on increasing the GPA for all students. 

```{r}
ggplot(ew, aes(y=gpa, x=term_idx, fill=crt)) + 
        geom_boxplot(alpha=.5, width=.3) +
        geom_violin(alpha=.3) + xlab("") + theme_bw() + ylab("GPA") + xlab("Semester") + 
        scale_fill_manual(values=crt.col, guide=FALSE) + 
        stat_summary(fun.y=mean, geom="point", shape=18, size=4)
```


### DWF rate
The percent of students receiving a repeatable grade has declined over the past four semesters. 
```{r}
ggplot(class, aes(y=dfw_rate, x=term_idx, col = crt, shape=crt, label=paste0(round(dfw_rate*100,1),"%"))) + 
          geom_text(nudge_y=.05)  + geom_point(size=5) + ylab("") + theme_bw() + 
          scale_color_manual(values=crt.col, name="Class Type") + scale_shape_discrete(guide=FALSE) +  
          scale_y_continuous(limits=c(0,1), labels=scales::percent) + xlab("") 
```


### Statistical Comparisons
```{r, results='show'}
cl <- class %>% ungroup() %>% arrange(term_idx) %>% select(term_idx, crt, classgpa, dfw, N, dfw_rate)
names(cl) <- c("Term", "Type", "Ave. GPA", "# DFW", "Enrollment", "DFW Rate")

kable(cl, digits=2, align='c', row.names=FALSE, caption='Class level performance characteristics') %>%  kable_styling(bootstrap_options="striped", full_width=F)
```

```{r}
gpa.crt.ew <- univ.gpa(ew, col.var = 'crt')
crt.p <- format.pval(unlist(summary(aov(gpa.crt.ew$test)))[9], digits=2)

gpa.crt.f146 <- univ.gpa(f146, col.var = 'crt')
```

* There is a significant improvement in GPA averaged across all redesigned sections compared to traditional (p=`r crt.p`). 
* There is also a significant improvement in average GPA in F16 compared to F14 (p=`r format.pval(gpa.crt.f146$test$p.value, digits=2)`). 
* The failure rate in F16 is lower than the failure rate in F14, but only marginally so (p=`r format.pval(chisq.test(ew$repeat_grade, ew$crt)$p.value, digits=2)`)
* The proportion of repeatable grades does not differ significantly across semesters (p=`r format.pval(chisq.test(f146$repeat_grade, f146$crt)$p.value, digits=2)`)


# Student Characteristics 

## Gender
### Course Type

Since Fall 14, the gender distribution has become closer to equal, with slightly more females than males since Spring 16. This difference is moderately statistically significant ($\chi^2_{3}$=6.5, p=.09).

```{r}
g.term <- biv.n.row.pct(df=ew, row.var = 'gender', col.var = 'term_idx')
chisq.test(table(ew$gender, ew$term_idx))
t.test((gender=="F") ~ term_idx, data=f146)
```

```{r, results='show'}
kable(g.term$table, row.names = FALSE, align='c', caption = "Distribution of gender across terms") %>%  
  kable_styling(bootstrap_options="striped", full_width=F)

g.term$plot + scale_y_continuous(labels=scales::percent, limits=c(.25, .75)) + 
  theme_bw() + ylab("") + xlab("Semester") + scale_color_manual(values=sex.col)
```


### Performance - GPA
There is no statistical difference in the average GPA between males and females, regardless of cohort. 

```{r}
gpa.gender.ew   <- univ.gpa(ew, col.var = 'gender')
gpa.gender.f146 <- univ.gpa(f146, col.var = 'gender')

a <- data.frame(gpa.gender.ew$table, 
               p = c(format.pval(gpa.gender.ew$test$p.value, digits=2), NA), 
               gpa.gender.f146$table[,-1],
               p2 = c(format.pval(gpa.gender.f146$test$p.value, digits=2), NA)
               )

names(a) <- c("Gender", "Mean", "SD", "p-value",  "Mean", "SD", "p-value")
```

```{r, results='show'}
kable(a, digits=2, align='c', caption="Comparison of GPA across genders") %>% 
    add_header_above(c(" " = 1, "Full Sample" = 3, "F14 and F16 only" = 3)) %>%
    kable_styling(bootstrap_options="striped", full_width=F)

```

```{r, fig.width=12, fig.height=6}
a <- gpa.gender.ew$plot + ggtitle("Full Sample") + xlab("") + scale_fill_manual(values=sex.col)
b <- gpa.gender.f146$plot + ggtitle("F14 & F16 only") + xlab("") + scale_fill_manual(values=sex.col)

grid_arrange_shared_legend(a, b, ncol=2, nrow=1, position="right")
```

```{r}
gpa.g.crt <- ew %>% group_by(crt, gender) %>% 
                  summarise(mean=mean(gpa), 
                            se = sd(gpa)/sqrt(n()), 
                            lcl=mean-1.96*se, 
                            ucl=mean+1.96*se) 
pd <- position_dodge(.1)
ggplot(gpa.g.crt, aes(x=crt, y=mean, group=gender, col=gender)) + 
        geom_point(size=2, position=pd) + geom_line(position=pd) +
        geom_errorbar(aes(ymin=lcl, ymax=ucl), width=.1, position=pd) + 
        scale_y_continuous(limits=c(0, 3)) + 
        theme_bw() + ylab("") + xlab("Course Type") + 
        scale_color_manual(name="Gender", values=sex.col) + 
        ggtitle("Mean (95 %CI) GPA by First Gen status and across genders")
```

A multiple linear regression model found that the redesign did not have a statistically different impact on males and females. 
```{r}
summary(lm(gpa~crt + gender + crt*gender, data=ew))
```


### Performance - DFW rate
There is no difference in proportion of males and females getting a repeatable grade on the entire sample, or when using data on the F14 and F16 cohorts only.

```{r}
fs <- ew %>% group_by(crt, gender, repeat_grade) %>% 
    summarise(count=n()) %>%
    mutate(pct=round(count/sum(count),3)) %>%
    mutate(Total = paste0(count, " (", pct*100,"%)"))
```


```{r, results='show'}
fs2 <- fs %>% arrange(crt, gender, repeat_grade) %>% select(-count, -pct) %>% mutate(ut = paste0(gender, "_", repeat_grade))

ws <- reshape(as.data.frame(fs2), timevar = 'ut', idvar='crt', direction="wide")
ws <- ws[,c(1, 4, 7, 10, 13)]
colnames(ws) <- c("Course Type", "Pass", "DFW", "Pass", "DFW")

kable(ws, align='c', row.names=FALSE,
      caption=" N(%) of students passing and failing Chem 111 by course type and gender") %>% 
  kable_styling(bootstrap_options="striped",full_width=F) %>% 
  add_header_above(c(" " = 1, "Females" = 2, "Males"=2)) 
```

```{r}
fsp <- fs %>% filter(repeat_grade==1)

ggplot(fsp, aes(x=crt, y=pct, group=gender, col=gender)) + 
    geom_point() + geom_line() + scale_y_continuous(labels=scales::percent, limits=c(0, 1)) + 
    theme_bw() + ylab("") + xlab("Course Type") + scale_color_manual(name="Gender", values=sex.col)
```

A logistic regression model on the full data indicates that students in the redesigned section (CRT and CRT + SI) have significantly lower odds of failing Chem 111 compared to students in the traditional courses after adjusting for gender. 

```{r, results="show"}
a <- mlogr.table(glm(pass ~ gender + crt, data=ew, family="binomial"))
names(a) <- c("OR", "CI", "p-value")
rownames(a) <- c("Gender", "CRT", "CRT + SI")

kable(a, align='c', caption="Logistic Regression of course type on the receipt of repeatable grade") %>% 
   kable_styling(bootstrap_options="striped", full_width=F)

```


**Summary:** The redesign had a positive effect on GPA and DWF rate after controlling for gender, and while it appears as if males improved more than females between Traditional and CRT + SI, the difference is not statistically significant. 


## Age 

### Course Type

Students in F14 were on average 0.68 (0.01, 1.34) years older than those in the two CRT semesters (p=.04), and 0.87 (0.1, 1.65) years older than students in Fall 16 (p=.02).

```{r}
age.crt.ew   <- biv.mean(df=ew, var='age', group='crt')
age.crt.ew$plot + scale_fill_manual(name="Class Type", values=crt.col)
```

```{r, results='show'}
kable(biv.mean.wide(df=ew, var='age', group='crt'), align='c', 
      caption="Mean and SD for ages within class types")  %>% 
      kable_styling(bootstrap_options="striped", full_width=F, position = "float_left")

kable(TukeyHSD(aov(age~crt, data=ew))$crt, digits=2, 
      caption="Tukeys Honest Significant Difference for differences in average age between all pairs of class types") %>% 
   kable_styling(bootstrap_options="striped", full_width=F, position = "float_right")
```

<br></br><br></br><br></br><br></br><br></br><br></br>



### Performance - GPA
GPA and age appear to have a non-linear relationship. Zooming in on students under 25, the relationship between age and GPA is decreasing until about 20, then increases afterward. 

```{r, fig.width=10}
a <- ggplot(ew, aes(x=age, y=gpa, col=crt)) + 
        geom_point(alpha=.5) + geom_smooth(se=FALSE) + theme_minimal() + 
        scale_color_manual(name="Course Type", values=crt.col)  + ggtitle("Everyone")

b <- ggplot(filter(ew, age<25), aes(x=age, y=gpa, col=crt)) + 
        geom_point(alpha=.5) + geom_smooth(se=FALSE) + theme_minimal() + 
        scale_color_manual(values=crt.col) + ggtitle("Under 25yrs")

grid_arrange_shared_legend(a, b, ncol=2, nrow=1, position="bottom")
```



A linear spline model was fit on the full sample using a knot at 20 to allow for a change in slope while controlling for the effect of the course type. 

```{r, results='show'}
lt25 <- subset(ew, age<25)
lt25$older <- (lt25$age - 20)
lt25$older[lt25$age<20] <- 0

fit.spline <- lm(gpa~age + older + crt, data=lt25)

a <- mlr.table(fit.spline)
names(a) <- c("Estimate", "CI", "p-value")
rownames(a) <- c("Age", "Over 20", "CRT", "CRT + SI")

kable(a, align='c') %>% 
   kable_styling(bootstrap_options="striped", full_width=F, position = "float_right")
```

Under 20, there is a very slight ($\beta=-0.09$) and non-significantly different from zero downward trend in GPA as age increases. For each year older than 20 a student is, the average GPA increases by 0.19 (p=.06). Students in the CRT + SI course have on average 0.34 higher GPA compared to students in the traditional class (p=.005).
  
An interaction term between age and course type was tested but found to be non-significant. This indicates that the intervention has a similar positive effect on a student's GPA regardless of their age. 

<br>

### Performance - DFW rate
There is no difference in the average age for students receiving a repeatable grade or not, with our without the older students included in the analysis. 
```{r}
age.dfw.ew   <- biv.mean(df=ew, var='age', group='pass')
a <- age.dfw.ew$plot + scale_fill_discrete(name="") + xlab("") + ggtitle("Full Sample - all ages")

agey.dfw.ew   <- biv.mean(df=filter(ew, age<25), var='age', group='pass')
b <- agey.dfw.ew$plot + scale_fill_discrete(name="") + xlab("") + ggtitle("Full sample - Under 25")+ ylab("")

age.dfw.f146   <- biv.mean(df=f146, var='age', group='pass')
d <- age.dfw.ew$plot + scale_fill_discrete(name="") + xlab("") + ggtitle("F14 and F16 - all ages")

agey.dfw.f146   <- biv.mean(df=filter(f146, age<25), var='age', group='pass')
e <- agey.dfw.ew$plot + scale_fill_discrete(name="") + xlab("") + ggtitle("F14 and F16 - Under 25") + ylab("")

grid_arrange_shared_legend(a, b, d, e, ncol=2, nrow=2, position="bottom")
```


```{r}
ds1 <- data.frame(g = c("No", "Yes"),
           age.dfw.ew$table[,-1], 
           p=c(format.pval(age.dfw.ew$test$p.value, digits=2), NA), 
           agey.dfw.ew$table[,-1], 
           p=c(format.pval(agey.dfw.ew$test$p.value, digits=2), NA))

ds2 <- data.frame(g = c("No", "Yes"),
           age.dfw.f146$table[,-1], 
           p=c(format.pval(age.dfw.f146$test$p.value, digits=2), NA), 
           agey.dfw.f146$table[,-1], 
           p=c(format.pval(agey.dfw.f146$test$p.value, digits=2), NA))

ds <- rbind(ds1, ds2)

names(ds) <- c("Repeat Grade", "Mean", "SD", "p-value",  "Mean", "SD", "p-value")
```

```{r, results='show'}
kable(ds, digits=2, align='c', 
      caption="Mean and SD of student ages grouped by whether or not they passed the class") %>% 
  kable_styling(bootstrap_options="striped", full_width=F, position = "float_left") %>% 
  add_header_above(c(" " = 1, "Full Sample" = 3, "F14 and F16 only" = 3)) %>%
  group_rows("All Ages", 1,2) %>%
  group_rows("Under 25", 3,4)
```


```{r, results="show"}
a <- mlogr.table(glm(pass ~ age + crt, data=ew, family="binomial"))
names(a) <- c("OR", "CI", "p-value")
rownames(a) <- c("Age", "CRT", "CRT + SI")

kable(a, align='c', caption="Logistic Regression of course type on the receipt of repeatable grade") %>% 
   kable_styling(bootstrap_options="striped", full_width=F, position = "float_right")

```

<br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br>

A logistic regression model on the full data across all ages indicates that students in the redesigned section (CRT and CRT + SI) have significantly lower odds of failing Chem 111 compared to students in the traditional courses after adjusting for age. 

**Summary:** The redesign had a positive effect on GPA and DWF rate after controlling for age. 


## Underrepresented Minority (URM)
The definition used in this report for an underrepresented minority student is as follows:

* Non-URM: Asian, NHOPI, White
* URM: Black, HL
* Unknown: Mult, Unk

### Course Type
The proportion of students in each URM category listed above has changed significantly since F14 ($\chi^2_{6}$=18.0, p=.006). Most notably is that the proportion of URM students has increased greatly from F14 to S16, becoming about the same proportion (40%) as the non-URM group. 

```{r}
urm.term <- biv.n.row.pct(df=ew, row.var = 'urm_status', col.var = 'term_idx')
chisq.test(table(ew$urm_status, ew$term_idx))
```

```{r, results='show'}
kable(urm.term$table, row.names = FALSE, align='c', 
      caption="Proportion of students in each URM classification across terms") %>% 
      kable_styling(bootstrap_options="striped", full_width=F)

urm.term$plot + scale_y_continuous(labels=scales::percent, limits=c(0, 1)) + 
  theme_bw() + ylab("") + xlab("Semester") + scale_color_discrete(name="URM Status")
```

### Performance - GPA

The distribution of GPA across URM status is similar for the entire sample and when only considering F14 and F16. 

```{r, fig.width=12, fig.height=6}
gpa.urm.ew    <- biv.mean(df=ew, var='gpa', group='urm_status')
gpa.urm.f146  <- biv.mean(df=f146, var='gpa', group='urm_status')

a <- gpa.urm.ew$plot + ggtitle("Full Sample") + xlab("") + scale_fill_discrete(name="")
b <- gpa.urm.f146$plot + ggtitle("F14 & F16 only") + xlab("") 

grid_arrange_shared_legend(a, b, ncol=2, nrow=1, position="right")
```


When comparing the average GPA across URM status for all four semesters combined, Non URM students have on average 0.39 (95% CI 0.18-0.60, p<.001) higher GPA compared to URM students. 

```{r, results='show'}
kable(biv.mean(df=ew, var='gpa', group='urm_status')$table, align='c', 
      caption="Mean (SD) of GPA within URM classification")  %>% 
      kable_styling(bootstrap_options="striped", full_width=F, position = "float_left")

kable(TukeyHSD(aov(gpa~urm_status, data=ew))$urm_status, digits=2, 
      caption="Tukeys Honest Significant Difference for pairwise differences in average GPA between URM classifications") %>% 
   kable_styling(bootstrap_options="striped", full_width=F, position = "float_right")
```

<br><br><br><br><br><br><br><br><br><br><br><br>


Next we examine how the average GPA for students in each URM classification changes with the different redesign models. The plot below shows the mean with 95% CI for each combination of URM status and course type. The confidence intervals are added to this plot to more easily identify which pairs of URM status within course type are different. If the CI bars do not overlap (e.g. Non-URM vs URM in the CRT) this is a significant difference. However, if the bars overlap that _does not_ mean there is _no_ difference. You cannot make a statistical conclusion if the bars overlap. 

```{r}
gpa.urm.crt <- ew %>% group_by(crt, urm_status) %>% 
                  summarise(mean=mean(gpa), 
                            se = sd(gpa)/sqrt(n()), 
                            lcl=mean-1.96*se, 
                            ucl=mean+1.96*se) 
pd <- position_dodge(.1)
ggplot(gpa.urm.crt, aes(x=crt, y=mean, group=urm_status, col=urm_status)) + 
        geom_point(size=2, position=pd) + geom_line(position=pd) +
        geom_errorbar(aes(ymin=lcl, ymax=ucl), width=.1, position=pd) + 
        scale_y_continuous(limits=c(0, 3)) + 
        theme_bw() + ylab("") + xlab("Course Type") + 
        scale_color_discrete(name="URM Status") + 
        ggtitle("Mean (95 %CI) GPA for each URM status across course type")
```

```{r, eval=FALSE}
urm.mod <- lm(gpa~crt + urm_status, data=ew)
a <- mlr.table(urm.mod) 
names(a) <- c("Estimate", "CI", "p-value")
rownames(a) <- c("CRT", "CRT + SI", "URM", "URM Unknown")

kable(a, align='c', caption="Linear regression estimates for a model of GPA on Coures type and URM status") %>% 
   kable_styling(bootstrap_options="striped", full_width=F, position = "float_right")
```

A multiple linear model of GPA using course type and URM status and the interaction between the two as predictors was run to test for a significant decrease in the gap between URM and non-URM students from each of the two redesigned course types compared to the traditional class. This is called a _difference of differences_ analysis.


```{r}
did.model <- lm(gpa~crt + urm_status + crt:urm_status, data=ew)

tm <- multcomp::glht(did.model, linfct=matrix(c(0,0,0,1,0,0,0,0,0),1))
cm <- multcomp::glht(did.model, linfct=matrix(c(0,0,0,1,0,1,0,0,0),1))
sm <- multcomp::glht(did.model, linfct=matrix(c(0,0,0,1,0,0,1,0,0),1))

ct <- data.frame(g=levels(ew$crt), 
           est = c(-0.38, -0.53 , -0.20), 
           ci = c("(-0.76, -0.01)", "(-0.77, -0.29)", "(-0.56 , 0.16)"), 
           p = c("0.0431", "<.0001", "0.271"))
```

```{r, results='show'}
names(ct) <- c("Course Type", "GPA gap", "CI", "p-value")
kable(ct, align='c', caption="Difference in GPA as URM - NonURM for each course type") %>% 
   kable_styling(bootstrap_options="striped", full_width=F, position = "float_right")
```

<br>

The table to the right shows that under the traditional course model the gap in GPA between URM and non URM was 0.38 (with URM being significantly lower), the gap widened to 0.53, with URM still being statistically significantly lower, but under the CRT + SI model of redesign, the gap decreased such that URM students do not have a significantly lower GPA compared to NonURM students. 

The decrease from 0.32 to 0.28 however is not statistically significant (p=0.48). 



<br><br><br><br>

### Performance - DFW rate

The failure rate for URM status has decreased as the level of intervention increased from Traditional to CRT to CRT + SI. 


```{r}
fs <- ew %>% group_by(crt, urm_status, repeat_grade) %>% 
    summarise(count=n()) %>%
    mutate(pct=round(count/sum(count),3)) %>%
    mutate(Total = paste0(count, " (", pct*100,"%)"))

fsp <- fs %>% filter(repeat_grade==1)

ggplot(fsp, aes(x=crt, y=pct, group=urm_status, col=urm_status)) + 
    geom_point() + geom_line() + scale_y_continuous(labels=scales::percent, limits=c(0, 1)) + 
    theme_bw() + ylab("") + xlab("Course Type") + scale_color_discrete(name="URM Status")
```

```{r, results='show'}
fs2 <- fs %>% arrange(urm_status, crt, repeat_grade) %>% select(-count, -pct) %>% mutate(ut = paste0(urm_status, "_", repeat_grade))

ws <- reshape(as.data.frame(fs2), timevar = 'ut', idvar='crt', direction="wide")
ws <- ws[,c(1, 4, 7, 10, 13, 16, 19)]
colnames(ws) <- c("Course Type", "Pass", "DFW", "Pass", "DFW", "Pass", "DFW")

kable(ws, align='c', row.names=FALSE,
      caption=" N(%) of students passing and failing Chem 111 by course type and URM status") %>% 
  kable_styling(bootstrap_options="striped",full_width=F) %>% 
  add_header_above(c(" " = 1, "Non-URM" = 2, "URM"=2, "Unknown"=2))
```

**Summary**: The CRT+SI redesign is associated with an improvement in GPA and reduction in DFW rates in URM students. 


## First Generation

### Course Type

The proportion of students that are first generation has remained statistically constant for the past four semesters. 

```{r}
fg.term <- biv.n.row.pct(df=ew, row.var = 'firstgeneration', col.var = 'term_idx')
chisq.test(table(ew$firstgeneration, ew$term_idx))
t.test((firstgeneration=="Y") ~ term_idx, data=f146)
```

```{r, results='show'}
kable(fg.term$table, row.names = FALSE, align='c', caption = "Proportion of first generation students across terms") %>%  
  kable_styling(bootstrap_options="striped", full_width=F)

fg.term$plot + scale_y_continuous(labels=scales::percent, limits=c(.25, .75)) + 
  theme_bw() + ylab("") + xlab("Semester") 
```

### Performance - GPA

When considering the entire four semesters, first generation students have on average 0.29 gpa points lower than non-first generation students. The difference is non-significant when only considering the F14 and F16 cohorts, indicating that these samples are not the same. 

```{r}
gpa.fg.ew   <- univ.gpa(ew, col.var = 'firstgeneration')
gpa.fg.f146 <- univ.gpa(f146, col.var = 'firstgeneration')

a <- data.frame(gpa.fg.ew$table, 
               p = c(format.pval(gpa.fg.ew$test$p.value, digits=2), NA), 
               gpa.fg.f146$table[,-1],
               p2 = c(format.pval(gpa.fg.f146$test$p.value, digits=2), NA)
               )

names(a) <- c("First Generation", "Mean", "SD", "p-value",  "Mean", "SD", "p-value")
```

```{r, results='show'}
kable(a, digits=2, align='c', caption="Comparison of GPA across first generation status") %>% 
    add_header_above(c(" " = 1, "Full Sample" = 3, "F14 and F16 only" = 3)) %>%
    kable_styling(bootstrap_options="striped", full_width=F)

```

```{r, fig.width=12, fig.height=6}
a <- gpa.fg.ew$plot + ggtitle("Full Sample") + xlab("") 
b <- gpa.fg.f146$plot + ggtitle("F14 & F16 only") + xlab("") 

grid_arrange_shared_legend(a, b, ncol=2, nrow=1, position="right")
```

Next we examine the average GPA for first generation and non-first generation students under the different redesign models. 
The mean profile plot with 95% CI below indicate that just flipping the classroom improves the overall GPA of the class, but primarily for non-first generation students only. However when adding SI to the course model the GPA for the first generation students rises to meet that of the non-first gen. This explains why the difference in average GPA is significantly different when considering the full sample, but not when considering the Traditional and CRT + SI cohorts only. 

```{r}
gpa.fg.crt <- ew %>% group_by(crt, firstgeneration) %>% 
                  summarise(mean=mean(gpa), 
                            se = sd(gpa)/sqrt(n()), 
                            lcl=mean-1.96*se, 
                            ucl=mean+1.96*se) 
pd <- position_dodge(.1)
ggplot(gpa.fg.crt, aes(x=crt, y=mean, group=firstgeneration, col=firstgeneration)) + 
        geom_point(size=2, position=pd) + geom_line(position=pd) +
        geom_errorbar(aes(ymin=lcl, ymax=ucl), width=.1, position=pd) + 
        scale_y_continuous(limits=c(0, 3)) + 
        theme_bw() + ylab("") + xlab("Course Type") + 
        scale_color_discrete(name="First Generation") + 
        ggtitle("Mean (95 %CI) GPA by First Gen status and across course type")
```


### Performance - DFW rate
The failure rate for each group decreases in a similar pattern to the improvement in GPA.

```{r}
fs <- ew %>% group_by(crt, firstgeneration, repeat_grade) %>% 
    summarise(count=n()) %>%
    mutate(pct=round(count/sum(count),3)) %>%
    mutate(Total = paste0(count, " (", pct*100,"%)"))

fsp <- fs %>% filter(repeat_grade==1)

ggplot(fsp, aes(x=crt, y=pct, group=firstgeneration, col=firstgeneration)) + 
    geom_point() + geom_line() + scale_y_continuous(labels=scales::percent, limits=c(0, 1)) + 
    theme_bw() + ylab("") + xlab("Course Type") + scale_color_discrete(name="First Generation")
```


```{r, results='show'}
fs2 <- fs %>% arrange(crt, firstgeneration, repeat_grade) %>% select(-count, -pct) %>% mutate(ut = paste0(firstgeneration, "_", repeat_grade))

ws <- reshape(as.data.frame(fs2), timevar = 'ut', idvar='crt', direction="wide")
ws <- ws[,c(1, 4, 7, 10, 13)]
colnames(ws) <- c("Course Type", "Pass", "DFW", "Pass", "DFW")

kable(ws, align='c', row.names=FALSE,
      caption=" N(%) of students passing and failing Chem 111 by course type and first generation status") %>% 
  kable_styling(bootstrap_options="striped",full_width=F) %>% 
  add_header_above(c(" " = 1, "Non-First Generation" = 2, "First Generation"=2)) 
```

For both groups the DFW rate went from 43-45% under the traditional course type, to 32-33% under redesign with SI. 

```{r}
summary(glm(repeat_grade ~ crt + firstgeneration + crt*firstgeneration, data=ew, family="binomial"))
summary(aov(lm(repeat_grade ~ crt + firstgeneration + crt*firstgeneration, data=ew)))
```

**Summary:** Both the course type and first generation status are associated with a difference in GPA and DFW rate, but the redesign type has different effects for first generation students, specifically the redesign was associated with an improvement in performance for non-first generation students only. Adding on SI to the redesigned class bridged that gap for the first generation students. 

## Admissions Index (HS Eligibility)

### Course Type

There is no significant difference in average admissions index across the three course types. 

```{r}
hsei.crt.ew   <- biv.mean(df=ew, var='admission_index', group='crt')
hsei.crt.ew$plot + scale_fill_manual(name="Class Type", values=crt.col) + ylab("HSEI")
```

```{r, results='show'}
kable(biv.mean.wide(df=ew, var='admission_index', group='crt'), align='c', 
      caption="Mean and SD of HSEI within class types")  %>% 
      kable_styling(bootstrap_options="striped", full_width=F, position = "float_left")

kable(TukeyHSD(aov(admission_index~crt, data=ew))$crt, digits=2, 
      caption="Tukeys Honest Significant Difference for differences in average HSEI between all pairs of class types") %>% 
   kable_styling(bootstrap_options="striped", full_width=F, position = "float_right")
```

<br></br><br></br><br></br><br></br><br></br><br></br>


### Performance - GPA
Admissions index does not have a strictly linear relationship with GPA, and that the relationship differs across the course types. For the Traditional and CRT + SI , there appears to be a flat relationship between HSEI and GPA until about HSEI=3.5, then a positive relationship for HSEI above 3.5. 

```{r}
ggplot(ew, aes(x=admission_index, y=gpa, col=crt)) + 
        geom_point(alpha=.5) + geom_smooth(se=FALSE) + theme_minimal() + xlab("HSEI") + 
        scale_color_manual(name="Course Type", values=crt.col) 
```

```{r, results='hide'}
lowhsei <- subset(ew, admission_index<3.5)
summary(lm(gpa ~ admission_index + crt + crt*admission_index, data=lowhsei))
#ggplot(lowhsei, aes(x=admission_index, y=gpa, col=crt)) + geom_point() + geom_smooth(se=FALSE, method="lm")
```

* The slopes below HSEI < 3.5 do not significantly differ based on course type - this is primarily due to the large standard error of the slope rather than the magnitude of the slope itself. 
* The GPA for students in the CRT + SI is moderately (p<.10) larger than the average GPA for students in the traditional classes (0.38, 95% CI -0.07, 0.83)


A linear spline model was fit on the full sample using a knot at 3.5 to allow for a change in slope. No interaction terms were included since there was no significant difference in slope across CRT group. 

```{r, results='show'}
ew$hsei_high <- (ew$admission_index - 3.5)
ew$hsei_high[ew$admission_index<3.5] <- 0

fit.spline <- lm(gpa~admission_index + hsei_high + crt, data=ew)

a <- mlr.table(fit.spline)
names(a) <- c("Estimate", "CI", "p-value")
rownames(a) <- c("Age", "HSEI over 3.5", "CRT", "CRT + SI")

kable(a, align='c') %>% 
   kable_styling(bootstrap_options="striped", full_width=F, position = "float_right")
```

* There no effect of HSEI on GPA when HSEI is below 3.5 (p=.7)
* There is a strong effect of HSEI on GPA when HSEI is above 3.5 (p=.0089)
* After controlling for HSEI there is still a significant improvement in GPA for students in the CRT + SI redesign compared to those in the traditional course. 

<br><br><br><br>

### Course Type - DFW 
Students who pass CHEM 111 have on average a 0.2 GPA higher admissions index compared to students who receive a repeatable grade (3.62 vs 3.82, p<.0001). 


```{r}
ggplot(ew, aes(y=admission_index, x=pass, fill=pass)) +  
       geom_boxplot(alpha=.5, width=.4) +
       geom_violin(alpha=.3) + xlab("") + 
       scale_fill_manual(values=crt.col, guide=FALSE) + 
       stat_summary(fun.y=mean, geom="point", shape=18, size=4) + 
       theme_minimal() + ylab("HSEI") + 
       ggtitle("Distribution of admissions index by course success status.") 
```

```{r, results='show'}
hs.pass  <- biv.mean(ew, var='admission_index', 'pass')

a <- data.frame(hs.pass$table, 
               p = c(format.pval(hs.pass$test$p.value, eps=.001), NA))

names(a) <- c("", "Mean", "SD", "p-value")

kable(a, digits=2, align='c', 
      caption="Mean and SD of admissions index grouped by whether or not they passed the class") %>% 
  kable_styling(bootstrap_options="striped", full_width=F, position = "float_left")
  
```


```{r, results="show"}
a <- mlogr.table(glm(pass ~ admission_index + crt, data=ew, family="binomial"))
names(a) <- c("OR", "CI", "p-value")
rownames(a) <- c("HSEI", "CRT", "CRT + SI")

kable(a, align='c', caption="Logistic Regression of course type on the receipt of repeatable grade") %>% 
   kable_styling(bootstrap_options="striped", full_width=F, position = "float_right")
```

<br><br><br><br><br><br><br><br><br><br><br><br><br>

**Summary**: 

* After controlling for admissions index, there is no direct effect of the course redesign on the likelihood a student will pass the course. 
* There is a positive relationship between admissions index and GPA, but only for a high admissions score. 
* The type of course redesign does not significantly change the relationship between admissions index and GPA. 


# Bivariate Summary

Demographic factors that were associated with GPA or passing the class:

* Age
* Under-represented minority classification
* First Generation status
* Admissions index - but not linearly

Formal student groups (EOP/Reach/TRIO/DSS) were unable to be analyzed due to either inconsistent data or small sample sizes.


```{r}
rm(a, cl, class, ct, ds, ds1, ds2, fs, fs2, fsp, gpa.fg.crt, gpa.g.crt, gpa.urm.crt, 
   lowhsei, lt25, ws, age.crt.ew, age.dfw.ew, age.dfw.f146, agey.dfw.ew, agey.dfw.f146, b, 
   cm, crt.p, d, did.model, e, fg.term, fit.spline, g.term, gpa.crt.ew, gpa.crt.f146, gpa.fg.ew, 
   gpa.fg.f146, gpa.gender.ew, gpa.gender.f146, gpa.urm.ew, gpa.urm.f146, hs.pass, hsei.crt.ew, pd,
   sm, tm, urm.term)
invisible(gc())
```
# Multivariable modeling

### Data preparation

#### Collapsing and grouping varibles. 

* The number of college prep math, English, and lab science classes were grouped into more reasonable ranges such as under 6 units, 6 to 8, and over 10. Reference groups are always no units of college prep classes. 
* The college in which the student is currently a major of was collapsed into
    - Other: BSS, BUS, CME, HFA, UGE
    - ECC
    - NS: NS and AGR
```{r}
# group number of CP classes
d2 <- ew %>% mutate(cpmath = cut(cp_math, c(0,6,8,10,17), right=FALSE),
                    cplab = cut(cp_lab, c(0,4,6,8,15), right=FALSE),
                    cpengl = (cp_engl>0))

## Recoding d2$college_name into d2$college_name_rec
d2$college_name_rec <- as.character(d2$college_name)
d2$college_name_rec[d2$college_name == "AGR"] <- "NS"
d2$college_name_rec[d2$college_name %in%  c("BSS", "BUS", "CME", "HFA", "UGE")] <- "OTH"
d2$college_name_rec <- factor(d2$college_name_rec, levels=c("NS", "ECC", "OTH"))
```


#### Restrict on age
Since 95% of the students are below 25 years of age, the multivariable model will be fit on only students less than 25 years of age. 

```{r}
# remove some variables that won't be used in random forest modeling
d3 <- d2 %>% select(-DSS, -erss_enrstat, -race_code, -term_idx, -erss_totunits, 
                        -dfw, -dfw_rate, -cohort, -enrollment, -classgpa, 
                        -cp_math, -cp_lab, -cp_engl, -soc, -college_name) %>% 
                 filter(age < 25)
```

#### Imputing missing values
About 15% of the records in the data were missing admissions index, so for the purpose of machine learning modeling missing values are imputed using predictive mean matching via the MICE (multiple imputation using chained equations) package in R. Only one computed data set is used (instead of multiple) for exploratory purposes only. 

```{r}
library(mice)
d4 <- d3 %>% select(-grade, -pass, -class_diff, -repeat_grade, -si.visits, -hsei_high, -origstartterm, -repeat_grade, -id, -year, -term, -sequential_term, -department_name, -major_name, -section)

# impute missing values for EPT and admssions index
d.imp <- mice(d4)
rf.dta <- complete(d.imp, 1)
```


## Variable Selection

A Random Forests model is fit to the full data, with all available student and class level information available to the model. This allows the model to consider the effects of secondary, non-demographic variables such as whether or not the student has passed a GE Math class by the time they take Chem 111, the number of units they are currently taking (including Chemistry), and if they participated in high impact practices such as Summer Bridge.

The plot below graphs the % increase in unexplained variance (mean squared error MSE) if that variable were excluded from the model. 

* A good model has a low amount of unexplained variance, so a high % increase means that variable plays an important role in predicting GPA. 
* For display purposes only those showing an increase of greater than .1% are displayed. 

```{r rf, fig.height=7, fig.width=7}
library(randomForest)
set.seed(12345)
a <- randomForest(gpa ~ ., data=rf.dta, importance=TRUE, ntree=1000)

plot.imp <- data.frame(var = rownames(a$importance), imp=round(a$importance[,1]*100,2)) %>% 
              arrange(desc(imp)) %>% filter(imp > .1)

ggplot(plot.imp, aes(x=imp, y=reorder(var, imp))) +  
  geom_point(size = 3) + xlab("% Increase in MSE") + 
  geom_text(aes(x=imp, y=reorder(var,imp), label=paste0(imp, "%")), nudge_y=.3) + 
  theme_bw() + ylab("Variable") + 
  theme(panel.grid.major.x = element_blank(),
        panel.grid.minor.x = element_blank(),
        panel.grid.major.y = element_line(color='grey60', linetype='dashed'))
```


Variables with high importance were then used as a starting point to build a multiple linear regression model to assess the effect of the course redesign after controlling for these other features. 

## Linear Regression on GPA

Prior to modeling, a single classification tree was built to determine the optimal location of knots for the known non-linear relationships between GPA, age and admissions index. Spline knots were created at HSEI = 3.8, and Age = 22 and included in the starting linear model.

```{r rpart, eval=FALSE}
library(rpart);library(rpart.plot)
set.seed(12345)
a <- rpart(gpa ~ age + admission_index , data=rf.dta)
rpart.plot(a)
```

```{r}
rf.dta$over22 <- (rf.dta$age - 22)
rf.dta$over22[rf.dta$age<22] <- 0
rf.dta$hseigt38 <- (rf.dta$admission_index - 3.8)
rf.dta$hseigt38[rf.dta$admission_index<3.8] <- 0

lm(gpa ~ term_gpa + admission_index + hseigt38 + stulevel + cpmath + 
                 college_name_rec + age + over22 + gender  + gemathdone + crt + 
                 geenlgdone + urm_status + cplab +  gecritdone + firstgeneration + 
                 term_units + cpengl + citizen
              , data=rf.dta)
```

Further variable selection was conducted via backwards selection, removing the variables that were found to be not significant with GPA with a pvalue > 0.5. Certain demographics of great interest (i.e. First Generation status) were kept in the model regardless of their statistical significance level. 

```{r}
mod <- lm(gpa ~ term_gpa + admission_index + hseigt38 + stulevel + cpmath + 
                 college_name_rec + gender  + gemathdone + crt + 
                 geenlgdone + urm_status + firstgeneration + 
                 cpengl
              , data=rf.dta)

#summary(aov(mod))
#summary(mod)
```

```{r, results='show'}
a <- mlr.table(mod)
names(a) <- c("Estimate", "CI", "p-value")
rownames(a) <- c("Term GPA", "HSEI", "HSEI > 3.8", "Level: Sophmore", 
                 "Level: Junior", "Level: Senior",  
                 "CP Math units: [6-8)", "CP Math units: [8-10)", "CP Math units: 10+",
                 "College: ECC", "College: Other", "Male", "GE Math Complete", 
                 "Redesign: CRT", "Redesign: CRT + SI", 
                 "GE English Complete", "URM", "URM-Unknown", "First Generation", 
                 "Any College prep English")

kable(a, align='c') %>% 
   kable_styling(bootstrap_options="striped")
```


**Summary**

After controlling for other significant and demographic characteristics:

* Gender
* URM status
* First generation status
* Admissions index
* Academic level
* College prep English and math classes
* Completion of GE English and Math classes
* Term GPA


Students in the CRT + SI class had significantly higher GPA compared to students in the traditional course (0.18, 95% CI (0.03-0.33), p=.0155). 

## Logistic Regression on a repeat grade

Improving GPA by 0.18 points is great, but this doesn't tell us which students are improving. Last we'll analyze the likelihood of a student passing the class. Again our goal is to see if the redesign alone, or in conjunction with SI moves the needle significantly on the lower performing students after controlling for other factors. 

```{r}
d4b <- d3 %>% select(-grade, -gpa, -class_diff, -repeat_grade, -si.visits, -hsei_high, -origstartterm, -repeat_grade, -id, -year, -term, -sequential_term, -department_name, -major_name, -section, -cpmath, -cplab, -cpengl)

# impute missing values for EPT and admssions index
d.imp <- mice(d4b)
class.dta <- complete(d.imp, 1)
```

Here we see a similar plot as before, that shows the variable importance. The difference again is that we are now predicting a student _passing_ the class, not simply their GPA. Each variable can inform the model differently. The measure being plotted here is the decrease in accuracy (correctly predicting the outcome), if that variable is not included in the model. Again for demonstration purposes only variables that would decrease the accuracy by over 0.1% are displayed. 

* Unsurprisingly, how well a student does across all classes that semester is a strong predictor for whether or not the student passes Chemistry. This serves as an excellent reminder that classes don't live in bubbles. If a student is doing poorly in one class, it is likely that they are struggling in their other classes as well. 

```{r class.model, fig.height=6, fig.width=7}
set.seed(12345)
a <- randomForest(pass ~ ., data=class.dta, importance=TRUE, ntree=1000)

plot.imp <- data.frame(var = rownames(a$importance), imp=round(a$importance[,1]*100,2)) %>% 
              arrange(desc(imp)) %>% filter(imp > .1)

ggplot(plot.imp, aes(x=imp, y=reorder(var, imp))) +  
  geom_point(size = 3) + xlab("% Decrease in Accuracy") + 
  geom_text(aes(x=imp, y=reorder(var,imp), label=paste0(imp, "%")), nudge_y=.3) + 
  theme_bw() + ylab("Variable") + 
  theme(panel.grid.major.x = element_blank(),
        panel.grid.minor.x = element_blank(),
        panel.grid.major.y = element_line(color='grey60', linetype='dashed'))
```

Using these variables as a starting point and subsequently doing backwards variable selection and testing some interaction terms we get to a final model to predict passing Chemistry 111 that includes: 

* term level GPA
* admissions index
* URM status
* Gender
* First generation
* College 
* Course Redesign type
* GE course status (English/Math/Critical Thinking)
* Entry level English/Math proficiency
* Interaction between admissions index and Course redesign type

The inclusion of this interaction term indicates that the type of course redesign _changes_ the relationship between admissions index and the probability of a student passing the course. 

```{r}
mod <- glm((pass=="Pass") ~ term_gpa + admission_index + urm_status +
              firstgeneration + crt + gender + college_name_rec + crt*admission_index + 
              geenlgdone + gecritdone + gemathdone + ept + elm 
           , data=class.dta, family='binomial')
```

The typical method of presenting results from a Logistic regression is to present the Odds Ratio, comparing the odds of passing the class for "Group A" compared to "Group B". Most people don't think in terms of Odds. So what we present here is the distribution of the _model predicted probability_ of passing the class, after controlling for all these other variables, and display this by course type. 

```{r}
pp <- predict(mod, type="response", se.fit=TRUE)
p <- data.frame(prob = pp$fit, se=pp$se.fit, crt=class.dta$crt, admission_index = class.dta$admission_index)

ggplot(p, aes(x=crt, y=prob, fill=crt)) +
        geom_boxplot(alpha=.5, width=.3) +
        geom_violin(alpha=.3) + xlab("") + theme_bw() + ylab("Predicted Probability of Passing Chemistry") + 
        xlab("Course Type") + 
        scale_fill_manual(values=crt.col, guide=FALSE) + 
        stat_summary(fun.y=mean, geom="point", shape=18, size=4)
```

```{r, results="show"}
summry <- p %>% group_by(crt) %>% summarise(mean=paste0(round(mean(prob)*100,1), "%"), 
                                            median=paste0(round(median(prob)*100,1), "%"))
kable(summry, align='c', caption="Mean and Median predicted probability of passing the class by class type") %>% 
   kable_styling(bootstrap_options="striped", full_width=F)
```

* The likelihood of passing Chem 111 significantly increases with the level of redesign (direct numbers not shown here). 
* Under the Traditional course offering, on average a student would have a 56.4% chance of passing the course (according to this model)
    - With CRT, on average a student would have 64.1% chance of passing the course
    - With CRT + SI, half the students were predicted to have up to 66.9% chance of passing the course. 
    
This may seem like a moderate gain, _only_ a 10.5% percentage point increase in predicted probability of passing the course from Traditional to CRT + SI, but remember this is after controlling for all other factors, such as admissions index. 

* This modeled probability reflects the unadjusted, raw, course (and coarse) level passing rates for the class. 
* This strengthens the justification that these improvements are likely due to the redesign itself, not something external. 
    
This is a good place to further demonstrate how the redesign affects students with different ranges of admissions index,  differently. The ranges shown here reflect the distribution of admissions index for Chemistry students: the bottom 25% of students had below a 3.5 admissions index, the median is 3.7, the third quartile is 4.0, with a max of 4.6. 

* For the bottom half of the class, the course redesign improved the predicted probability of passing the course. 
* For the upper half, there was either no, or a negative effect of the redesign. 
    - These comparisons were not tested directly for statistical significance, but the redesign *did* significantly change the relationship between HSEI and the likelihood of passing the course. This plot simply demonstrates in what direction and magnitude that change occurred. 

```{r}
p.cat <- p %>% mutate(ai_cat = cut(admission_index, c(2.5, 3.5, 3.75, 4, 5)))

ggplot(p.cat, aes(x=crt, y=prob, fill=crt)) +
        geom_boxplot(alpha=.5, width=.3) + 
        geom_violin(alpha=.3) + xlab("") + theme_bw() + ylab("Predicted Probability of Passing Chemistry") + 
        xlab("Course Type") + facet_wrap(~ai_cat) + 
        scale_fill_manual(values=crt.col, guide=FALSE) + 
        stat_summary(fun.y=mean, geom="point", shape=18, size=4)
```


**Summary**

* Course redesign significantly increased the probability a student will pass Chemistry 111. 

#### Notes and Comments
* These models are an additive, each covariate is modeled as if it modifies GPA or the probability of passing the class in a linear manner. 
* This model is simple in that unless interactions between variables are explicitly specified, they are not considered. 
* This differs from the supervised learning model such as a Random Forest model, that allows for all variables to interact with each other. 
    - The purpose of these models is classification, not assessing the impact of a covariate on an outcome. 
* The effect for all categorical variables represent a change from baseline or reference group, to the group listed. 
* This analysis only examined courses taught by the same instructor across four semsters to assess the effectiveness of a single individual course redesign. 


# Next steps / Needed followup

* Enhancements to the current model
    - Control for whether or not the student is on the second time taking the class.
* Create an SI specific model
    - using additional data from Spring 16, and other Chemistry classes other than Chem 111 and by other instructors. 
* Key informant interviews with top performing students to identify what they don't like.  

This would allow us to examine the following questions: 

* Can we show that SI is related to the reduction of the GAP between first gen and/or URM students? 
* How does the DFW rate change as a function of SI attendance?
* Do people self-select into SI based on a measurable characteristic?



