---
title: 'Historical Trends in Students taking Chem 111'
output:
  html_document:
    toc: true
    toc_float: true
    toc_depth: 3
---

This section analyses the trends in characteristics of the student group who is taking Chemistry 111, and compares them to the campus level averages. 

We consider data from Fall 2009 - Fall 2016, for all sections of Chemistry 111. Students withdrawing or receving an incomplete (`W/I`) are exluded from this analysis. A repeatable grade is defined as a student reciving a `D, D+`, or `F` grades, or an unexcused withdrawl `WU`. 


```{r, echo=FALSE, warning=FALSE, message=FALSE}
library(dplyr);library(knitr); library(kableExtra); 
library(RColorBrewer); library(ggplot2);
library(gridExtra); library(grid)
library(scales); library(foreach); library(plotly)

'%ni%' <- Negate('%in%')

opts_chunk$set(warning=FALSE, message=FALSE, echo=FALSE, row.names = FALSE, cache=FALSE,
               fig.align = 'center',  fig.width=8, fig.height=5)
options(knitr.kable.NA = '') 

source("C:/Dropbox/Professional/Grants_Current/SS Chemistry Data Mining/code/helper functions.R")
rawtrends <-read.delim("C:/Dropbox/Professional/Grants_Current/SS Chemistry Data Mining/data/chem_data_20170227.txt", sep = "\t")
campus_aves <- read.delim("C:/Dropbox/Professional/Grants_Current/SS Chemistry Data Mining/data/campus_aves.txt", sep="\t")
campus_props <- read.delim("C:/Dropbox/Professional/Grants_Current/SS Chemistry Data Mining/data/campus_props.txt", sep="\t")


chem <- rawtrends %>% filter(grade %ni% c('W ', 'I ') & erss_stulevel < 5) %>% droplevels() %>%
            mutate(term_idx = factor(term_idx, 
                      levels = c("F09", "S10", "F10", "S11", "F11", "S12", "F12", "S13", 
                                "F13", "S14", "F14", "S15", "F15", "S16", "F16")),
                    stulevel = factor(erss_stulevel, labels = c("Freshman", "Sophomore", "Junior", "Senior")), 
                    DSS = ifelse(dss.1==1 | dss == 'Y', 'DSS', 'not in DSS'), 
                    repeat_grade = ifelse(grade %in% c('D ', 'D+', 'F ', 'WU'), 1, 0)) %>%
            select(-dss.1, -dss, -erss_stulevel, erss_enrstat, -dfw_rate)
                

# redo class level measures
class <- chem %>% group_by(year, term, term_idx, section) %>%
          summarise(classgpa = mean(gpa), dfw = sum(repeat_grade), 
                    enrollment = n(), dfw_rate = dfw/enrollment)
         
yearlab <- c(2009, rep(2010:2016, each=2))
term.col <- brewer.pal(9, "Set1")[c(7, 3)]
```


# Course Characteristics

## Enrollment
```{r}
ggplot(chem, aes(x=term_idx, y=..count.., fill=term)) + geom_bar() +
  geom_text(stat="count", aes(y = ..count.., vjust=-.3, label=..count..)) +
  xlab("Year") + ylab("Enrollment") + theme_bw() +  
  scale_x_discrete(labels=yearlab) + scale_fill_manual(values=term.col, name = "Term")
```
  
Spring term demand has steadily increased since 2009. 
 
## Class size

Fall class sizes have remained relativley constant between 140-160 since 2009, even with an additional section starting in 2013. 
You can hover over the plot to see the actual enrollment numbers. 

```{r}
p <- ggplot(class, aes(x=term_idx, y=enrollment, group=term, col=term)) + 
  geom_point() + geom_smooth(se=FALSE) + xlab("Semester") + ylab("Enrollmenet") +
  scale_color_manual(values=term.col, name = "Term")+ theme_bw() +
  scale_y_continuous(limits=c(40, 180)) + ggtitle("Class Size")

ggplotly(p, tooltip = c("y", "x")) %>% config(displayModeBar = F)
```
  

## GPA
The average class-level gpa across years is `r round(mean(class$classgpa, na.rm=TRUE), 2)`, with standard deviation `r round(sd(class$classgpa, na.rm=TRUE), 2)`. Spring and Fall semesters have different patterns of oscilating increase and decrease of class-level GPA, but there is no statistical linear trend across terms nor a difference in average GPA between Fall and Spring. 

```{r}
#lm(classgpa~as.numeric(term_idx)+ term, data=class)
#t.test(classgpa~term, data=class)

p <- ggplot(class, aes(x=term_idx, y=classgpa, group=term, col=term)) + 
  geom_point(aes(size=enrollment)) + geom_smooth(se=FALSE) + xlab("Semester") + 
  scale_color_manual(values=term.col, name = "Term") + theme_bw() +
  scale_y_continuous(limits = c(1,3)) + ylab("Class Average GPA, size of point depicts size of class") 

ggplotly(p, tooltip = c("y", "x", "group"))%>% config(displayModeBar = F)
```



## DFW rate

As expected we see a similar pattern, slightly different between Fall and Spring, for the number and % of student receiving a repeatable grade _(D/F/WU)_. 

```{r}
c_0NA <- class %>% filter(term_idx != "NA") %>% mutate(dfw_rate = round(dfw_rate,2))

a <- ggplot(class, aes(x=term_idx, y=dfw_rate, group=term, col=term)) + ylab("") + 
            geom_point(aes(size=enrollment)) + geom_smooth(se=FALSE) + xlab("Semester") + 
            scale_color_manual(values=term.col, name = "Term")+ theme_bw() + 
            scale_y_continuous(limits=c(0,1), breaks=seq(0, .80, by=.20),
                               labels = scales::percent_format()) + 
            ggtitle("DWF Rate by semester, size of point depicts size of class") 

ggplotly(a, tooltip = c("y", "size", "enrollment"))%>% config(displayModeBar = F)

```

# Student Characteristics 

## Demographics

### Gender

Campus has a seen a steady rate of slightly higher than 50% female students for the past 7 years. Female enrollment in Chem111 has been historically much lower than the campus average, but a clear uptick is being seen since AY14-15. 

```{r}
campus.pf <- campus_props %>% filter(var=="gender" & level=="F") %>% 
              mutate(pf = pct) %>% select(term_idx, term, pf)

pft <- chem %>% 
  filter(term_idx != "NA") %>%
  group_by(term, term_idx, section) %>% 
  summarise(pf = mean((gender=="F"), na.rm=TRUE)) %>%
  bind_rows(campus.pf) %>% mutate(percent_female = round(pf,2))

a <- ggplot(pft, aes(x=term_idx, y=percent_female, col=term, group=term)) +
  geom_point() + geom_smooth(se=FALSE) + ylab("") + 
  scale_color_manual(values=c("black", term.col), name = "Term")+ theme_bw() +
  ggtitle("Proportion of females per class") + xlab("Semester") + 
  scale_y_continuous(labels = scales::percent_format(), limits=c(.2, .7)) 


ggplotly(a, tooltip = c("y", "x", "group"))%>% config(displayModeBar = F)

rm(a, pft, campus.pf)
```


### Age
```{r}
ave <- campus_aves %>% filter(var=="age") %>% mutate(mean=median) %>%
          select(term, term_idx, mean, p10, p90) 
            
age <- chem %>% 
  filter(term_idx != "NA") %>%
  group_by(term, term_idx, section) %>% 
  summarise(mean = mean(age, na.rm=TRUE)) %>%
  bind_rows(ave) %>% mutate(mean=round(mean,1))

p <- ggplot(age, aes(x=term_idx, y=mean, col=term, group=term)) +
      geom_point(size=3) + geom_smooth(se=FALSE) + ylab("Age") + 
      scale_color_manual(values=c("grey20", term.col), name = "Term")+ theme_bw() +
      ggtitle("Average student age per section") + xlab("Semester") + 
      scale_y_continuous(limits=c(17, 24))
  
ggplotly(p, tooltip = c("y", "x", "group")) %>% config(displayModeBar = F)
rm(ave, age, p)
```
  
The black horizonal line represents the **median** age of all students across campus -- at the time of enrollment. From 2009 to about 2013 there was an increase in the average age of students at enrollment campus wide, which has seemed to have leveled off. 

Students taking Chemistry tend to be slightly younger than the average campus age, and those taking Chemistry in the fall are on average younger than those taking chemistry in the Spring. Recall this is age at admission, not the age when the student is taking Chem 111. 


### Residential Area

The patterns of trend for the shifting demographics for where the students come from and enroll in Chemistry is similar to the overall campus trends. We see a decline in the proportion of students coming from Butte County (gold line), our general service area (red-orange line), and from the Rest of California (purple line) in general. There is steep increase in the enrollment from students in the Los Angeles area since around Fall 2011 (green line). By the F16 23% of the campus population is from the LA area, whereas these students make up 31% of Chemistry 111 classes in F16. 

```{r}
rt <- chem %>%
  filter(residareaname != "NA", term_idx != "NA") %>%
  group_by(term_idx, residareaname) %>%
  summarise(n=n()) %>%
  mutate(pct=round(n/sum(n),2), term="Chem 111")

campus.area <- campus_props %>% filter(var=="residareaname") %>% 
                mutate(residareaname=level) %>% select(term_idx, term, residareaname, pct)

art <- bind_rows(rt, campus.area)

ggplot(art, aes(x=term_idx, y=pct, col=residareaname, group=residareaname)) + geom_point() +
  scale_y_continuous(labels = scales::percent_format(), limits = c(0,.5)) + xlab("Semester") +
  ylab("% Areas") + geom_smooth(se=FALSE) + theme_bw() + theme(legend.position="bottom") + 
  scale_color_discrete(name = "Area of Residence") + facet_wrap(~term)
```

### Citizenship
The proportion of non-citizens enrolled campus-wide levels off at about 5%, but there has been an increase in non-citizens enrolling in Chem 111 since around 2011. The three sections of Chem 111 in Fall 16 had 5%, 8% and 11% non-citizens enrolled in their classes.

```{r}
campus.pnc <- campus_props %>% filter(var=="citizen" & level=="N") %>% 
              mutate(pnc = pct) %>% select(term_idx, term, pnc)
ct <- chem %>%
  filter(term_idx != "NA") %>%
  group_by(term, term_idx, section) %>% 
  summarise(pnc = mean((citizen=="N"), na.rm=TRUE)) %>%
  bind_rows(campus.pnc) %>% mutate(percent_noncitizen = round(pnc,2))

b <- ggplot(ct, aes(x=term_idx, y=percent_noncitizen, col=term, group=term)) +
  geom_point() + geom_smooth(se=FALSE) + ylab(" ") + 
  scale_color_manual(values=c("black", term.col), name = "Term")+ theme_bw() +
  xlab("Semester") +
  scale_y_continuous(limits=c(0, .25), labels = scales::percent_format())

ggplotly(b, tooltip = c("y", "x", "group")) %>% config(displayModeBar = F)

rm(b, campus.pnc, ct)
```
  
  
### Disabled Student Services

Students who are recieving services from DSS has varied over the past 7 years, but generally stayed below 5%, which is what the campus average has been at since around Spring 2013. 

```{r}
campus.pd <- campus_props %>% filter(var=="dss" & level=="Y") %>% 
              mutate(pd = pct) %>% select(term_idx, term, pd)
dt <- chem %>%
  filter(term_idx != "NA") %>%
  group_by(term, term_idx, section) %>% 
  summarise(pd = mean((DSS=="DSS"), na.rm=TRUE)) %>%
  bind_rows(campus.pd) %>% mutate(percent_dss = round(pd,2))
cc <- ggplot(dt, aes(x=term_idx, y=percent_dss, col=term, group=term)) +
  geom_point() + geom_smooth(se=FALSE) + ylab(" ") + 
  scale_color_manual(values=c("black", term.col), name = "Term")+ theme_bw() +
  ggtitle("Proportion of DSS students per section") + xlab("Semester") +
  scale_y_continuous(labels = scales::percent_format(), limits = c(0, .25))

ggplotly(cc, tooltip = c("y", "x", "group"))%>% config(displayModeBar = F)

rm(cc, dt, campus.pd)
```
  
  
### EOP Status
The proportion of students who are participating in the EOP program while enrolled in Chem 111 have historically been higher than the campus level average. There is indiciation that while the campus average remains constant at about 7%, both Fall and Spring terms for Chemistry have declined to 3-4% by 2016. Between 2011 and 2014 the average proportion of students in EOP was higher in Spring than it was in the Fall, nearly double in some cases (6% vs 12%).

**Note** These higher numbers of EOP students in the spring could be students who did not pass Chem 111 in the Fall and so are repeating the class in the Spring. 

```{r}
campus.peop <- campus_props %>% filter(var=="eopstat" & level=="Y") %>% 
              mutate(peop = pct) %>% select(term_idx, term, peop)

eopt <- chem %>%
  filter(term_idx != "NA") %>%
  group_by(term, term_idx, section) %>% 
  summarise(peop = mean(eop, na.rm=TRUE)) %>%
  bind_rows(campus.peop) %>% mutate(percent_eop = round(peop,2))

d <- ggplot(eopt, aes(x=term_idx, y=percent_eop, col=term, group=term)) +
  geom_point() + geom_smooth(se=FALSE) + ylab(" ") + 
  scale_color_manual(values=c("black", term.col), name = "Term")+ theme_bw() +
  ggtitle("Proportion of EOP students per section") + xlab("Semester") +
  scale_y_continuous(labels = scales::percent_format(), limits = c(0, .25))

 campus.pd <- campus_props %>% filter(var=="dss" & level=="Y") %>% 
              mutate(pd = pct) %>% select(term_idx, term, pd)

ggplotly(d, tooltip = c("y", "x", "group"))%>% config(displayModeBar = F)

rm(d, eopt, campus.pd)
```
  


### REACH
Campus level averages for the Reach program were not available. Furthermore, it appears as if the program was either not contributing data to the SIS system or not in place prior to Fall 2013. 

```{r}
reacht <- chem %>%
  filter(term_idx != "NA") %>%
  group_by(term, term_idx, section) %>% 
  summarise(prea = mean(reach, na.rm=TRUE))

d <- ggplot(reacht, aes(x=term_idx, y=prea, col=term, group=term)) +
  geom_point() + geom_smooth(se=FALSE) + ylab("% Reach") + 
  scale_color_manual(values=term.col, name = "Term") + theme_bw() +
  ggtitle("Proportion of Reach students per section") + xlab("Semester") +
  scale_y_continuous(labels = scales::percent_format(), limits = c(0, .25))

ggplotly(d, tooltip = c("y", "x", "group"))%>% config(displayModeBar = F)

rm(d, eopt, campus.pd)

```
  
### Any formal student group

This section considers membership in any formal student support group such as DSS, Reach, TRIO and other programs where data was available. Campus averages are not available for this combined group. 

  
```{r}
fsgt <- chem %>%
  filter(term_idx != "NA") %>%
  group_by(term, term_idx, section) %>% 
  summarise(pfsg = mean(fsg, na.rm=TRUE))
ggplot(fsgt, aes(x=term_idx, y=pfsg, col=term, group=term)) +
  geom_point() + geom_smooth(se=FALSE) + ylab("% FSG") + 
  scale_color_manual(values=term.col, name = "Term") + theme_bw() +
  ggtitle("Proportion of students in any FSG per section") + xlab("Semester") +
  scale_y_continuous(labels = scales::percent_format(), limits = c(0, .5))
```
  
### <a id="race_trends"></a> Race Code 
```{r}
rct <- chem %>%
  filter(race_code != "NA", term_idx != "NA") %>%
  group_by(term_idx, race_code) %>%
  summarise(n=n()) %>%
  mutate(prc=n/sum(n))
ggplot(rct, aes(x=term_idx, y=prc, col=race_code, group=race_code)) + geom_point() +
  xlab("Semester") + ggtitle("Proportion of students' race per semester") + ylab("% RACE") +
  geom_smooth(se=FALSE) + theme_bw() + scale_y_continuous(limits=c(0, 1), labels = scales::percent_format()) +
  scale_color_discrete(name = "Race")
```
  


### URM

  
```{r}
urmt <- chem %>%
  filter(urm_status != "NA", term_idx != "NA") %>%
  group_by(term_idx, urm_status) %>%
  summarise(n=n()) %>%
  mutate(purm=n/sum(n))
ggplot(urmt, aes(x=term_idx, y=purm, col=urm_status, group=urm_status)) + geom_point() +
  xlab("Semester") + ggtitle("Proportion of students' URM status per semester") + ylab("% URM status") +
  geom_smooth(se=FALSE) + theme_bw() + scale_y_continuous(limits=c(0, 1), labels = scales::percent_format()) +
  scale_color_discrete(name = "URM Status")

```
  
### SOC

```{r}
soct <- chem %>%
  filter(soc != "NA", term_idx != "NA") %>%
  group_by(term_idx, soc) %>%
  summarise(n=n()) %>%
  mutate(psoc=n/sum(n))
ggplot(soct, aes(x=term_idx, y=psoc, col=soc, group=soc)) + geom_point() +
  xlab("Semester") + ggtitle("Proportion of students' SOC status per semester") + ylab("% SOC status") +
  geom_smooth(se=FALSE) + theme_bw() + scale_y_continuous(limits=c(0, 1), labels = scales::percent_format()) +
  scale_color_discrete(name = "SOC Status")
```

## Pre-enrollment Information  
  
### Admission Index
```{r}
ai <- chem %>% 
  filter(term_idx != "NA") %>%
  group_by(term, term_idx, section) %>% 
  summarise(mean = mean(admission_index, na.rm=TRUE)) %>% ungroup()

aai <- mean(chem$admission_index, na.rm=TRUE)

ggplot(ai, aes(x=term_idx, y=mean, col=term, group=term)) +
  geom_point() + geom_smooth(se=FALSE) + ylab("Average admission index") + 
  scale_color_manual(values=term.col, name = "Term") + theme_bw() +
  ggtitle("Average student admission index per section") + xlab("Semester") + 
  geom_hline(yintercept=aai) + scale_y_continuous(limits=c(3.5,4))
```

```{r}
hsei_out <- biv.var(df=chem, var='admission_index',  row.var='section', col.var='term_idx')
hsei_out1 <- hsei_out[1:3,1:8]
hsei_out2 <- hsei_out[c(1,2,4),c(1,9:15)]

kable(hsei_out1,  align='c', row.names=FALSE, caption='Mean(sd) HSEI per section, per term (09-12)')
kable(hsei_out2,  align='c', row.names=FALSE, caption='Mean(sd) HSEI per section, per term (13-16)')
```



  
## Tests and Benchmarks

### GE-Breadth Course Completion Status

```{r}
matht <- chem %>%
  filter(term_idx != "NA") %>%
  group_by(term_idx, section) %>% 
  summarise(prop = mean(gemathdone, na.rm=TRUE)) %>%
  mutate(GE = "Math")
engt <- chem %>%
  filter(term_idx != "NA") %>%
  group_by(term_idx, section) %>% 
  summarise(prop = mean(geenlgdone, na.rm=TRUE)) %>%
  mutate(GE = "English")  
critt <- chem %>%
  filter(term_idx != "NA") %>%
  group_by(term_idx, section) %>% 
  summarise(prop = mean(gecritdone, na.rm=TRUE)) %>%
  mutate(GE = "Critical Thinking")
get <- rbind(matht, engt, critt)

ggplot(get, aes(x=term_idx, y=prop, col=GE, group=GE)) + geom_point() + xlab("Semester") + 
  ggtitle("Proportion of students who have completed these GE's\nprior to enrolling at a CSU campus per semester") +
  ylab("% Completed GE's") + geom_smooth(se=FALSE) + theme_bw() +
  scale_y_continuous(limits=c(0, .5), labels = scales::percent_format())

```
  

### ELM
```{r}
campus.pelm <- campus_props %>% filter(var=="elm" & level=="1") %>% 
              mutate(pelm = pct) %>% select(term_idx, term, pelm)

elmt <- chem %>%
  filter(term_idx != "NA") %>%
  group_by(term, term_idx, section) %>% 
  summarise(pelm = mean(elm, na.rm=TRUE)) %>%
  bind_rows(campus.pelm) %>% mutate(percent_elm = round(pelm,2))

e <- ggplot(elmt, aes(x=term_idx, y=percent_elm, col=term, group=term)) +
  geom_point() + geom_smooth(se=FALSE) + ylab("") + 
  scale_color_manual(values=c("black", term.col), name = "Term") + theme_bw() +
  ggtitle("Proportion of students per section who have completed\nthe ELM requirement prior to enrollment in CHEM") +
  xlab("Semester") +
  scale_y_continuous(labels = scales::percent_format(), limits=c(.75,1))

ggplotly(e, tooltip = c("y", "x", "group"))%>% config(displayModeBar = F)

rm(e, elmt, campus.pelm)
```
  

### EPT

```{r}
campus.pept <- campus_props %>% filter(var=="ept" & level=="1") %>% 
              mutate(pept = pct) %>% select(term_idx, term, pept)
eptt <- chem %>%
  filter(term_idx != "NA") %>%
  group_by(term, term_idx, section) %>% 
  summarise(pept = mean(ept, na.rm=TRUE)) %>%
  bind_rows(campus.pept) %>% mutate(percent_ept = round(pept,2))

f <- ggplot(eptt, aes(x=term_idx, y=percent_ept, col=term, group=term)) +
  geom_point() + geom_smooth(se=FALSE) + ylab("") + 
  scale_color_manual(values=c("black", term.col), name = "Term") + theme_bw() +
  ggtitle("Proportion of students per section who have completed\nthe EPT requirement prior to enrollment in CHEM") +
  xlab("Semester") +
  scale_y_continuous(labels = scales::percent_format(), limits = c(.8, 1))

ggplotly(f, tooltip = c("y", "x", "group"))%>% config(displayModeBar = F)

rm(f, eptt, campus.pept)
```
  

  
### College prep

    
```{r}
cpet <- chem %>%
  filter(term_idx != "NA") %>%
  group_by(term_idx, section) %>% 
  summarise(prop = mean(cp_engl, na.rm=TRUE)) %>%
  mutate(CP = "English")
cpmt <- chem %>%
  filter(term_idx != "NA") %>%
  group_by(term_idx, section) %>% 
  summarise(prop = mean(cp_math, na.rm=TRUE)) %>%
  mutate(CP = "Math")  
cplt <- chem %>%
  filter(term_idx != "NA") %>%
  group_by(term_idx, section) %>% 
  summarise(prop = mean(cp_lab, na.rm=TRUE)) %>%
  mutate(CP = "Lab")
cpt <- rbind(cpet, cpmt, cplt)

ggplot(cpt, aes(x=term_idx, y=prop, col=CP, group=CP)) + geom_point() +
  xlab("Semester") + ggtitle("Ave. # of college prep classes students have taken at admission per semester") +
  ylab("Average # of CP semesters") +
  geom_smooth(se=FALSE) + theme_bw() + scale_y_continuous()
```



```{r}
cont.varlist <- c('cp_engl', 'cp_math', 'cp_lab')

samp.means <- foreach(i = 1:3, .combine = rbind) %dopar% {
                mv.mean.wide(df=chem, var=cont.varlist[i], 
                             group='term_idx', col.lab=levels(chem$term_idx))
}

cp.out <- t(samp.means[c(2,4,6),])
colnames(cp.out) <- c("Engl", "Math", "Lab Sci")

kable(cp.out, align='ccc', caption = "Mean(SD) for number of college prep classes by term.")
```


    
## Academic Standing

### College
```{r}
rt <- chem %>%
  group_by(term_idx, college_name) %>%
  summarise(n=n()) %>%
  mutate(pct=n/sum(n))
ggplot(rt, aes(x=term_idx, y=pct, col=college_name, group=college_name)) + geom_point() +
  scale_y_continuous(labels = scales::percent_format(), limits = c(0,.5)) + xlab("Semester") +
  ggtitle("Proportion of colleges students are in per semester") + ylab("% Colleges") +
  geom_smooth(se=FALSE) + theme_bw() + scale_color_discrete(name = "College Name")
```
  
  
### Student Level
```{r}
slt <- chem %>%
  filter(!is.na(stulevel)) %>%
  group_by(term_idx, stulevel) %>%
  summarise(n=n()) %>%
  mutate(percent=round(n/sum(n),2))

a <- ggplot(slt, aes(x=term_idx, y=percent, col=stulevel, group=stulevel)) + geom_point() +
      scale_y_continuous(labels = scales::percent_format(), limits = c(0,.75)) + xlab("Semester") +
      ggtitle("Proportion of students at each academic status per semester") + ylab("") +
      geom_smooth(se=FALSE) + theme_bw() + 
      scale_colour_discrete(name = "Student Level",
                            labels = c("Freshman", "Sophomore", "Junior", "Senior"))

ggplotly(a, tooltip = c("y", "x", "group"))%>% config(displayModeBar = F)

rm(a, slt)
```

  

### Units taken this semester

```{r}
utt <- chem %>% 
  filter(term_idx != "NA") %>%
  group_by(term, term_idx, section) %>% 
  summarise(mean = mean(term_units, na.rm=TRUE))
autt <- mean(chem$term_units, na.rm=TRUE)

ggplot(utt, aes(x=term_idx, y=mean, col=term, group=term)) +
  geom_point() + geom_smooth(se=FALSE) + ylab("Average units") + 
  scale_color_manual(values=term.col, name = "Term")+ theme_bw() +
  ggtitle("Average # of units students are taking while enroll in CHEM111 per section") +
  xlab("Semester") + 
  geom_hline(yintercept=autt) + scale_y_continuous()
```
  
  
```{r}
units_out <- biv.var(df=chem, var='term_units',  row.var='section', col.var='term_idx')
units_out1 <- units_out[1:3,1:8]
units_out2 <- units_out[c(1,2,4),c(1,9:15)]

kable(units_out1,  align='c', row.names=FALSE, caption='Mean(sd) student course load per section per term (09-12)')
kable(units_out2,  align='c', row.names=FALSE, caption='Mean(sd) student course load per section per term (13-16)')
```



